<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
  <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
  <title></title>
  <link rel="stylesheet" href="../../../assets/css/api.css"/>
  <link rel="stylesheet" href="../../../assets/css/style.css">
  <link rel="stylesheet" href="../../../assets/iconfont/iconfont.css">
  <style>
    #app {
      background: #f0f0f0;
    }

    .content {
      padding: 2rem 1rem 0.5rem 1rem;
    }

    .content-copy {
      padding: 2rem 1rem 0.5rem 1rem;
      background: rgba(0, 0, 0, .8);
    }

    .icon1 {
      width: 0.5rem;
      height: 0.5rem;
    }

    .icon2 {
      width: 2rem;
      height: 2rem;
      margin-bottom: 0.3rem;
    }

    .content-top {
      font-size: 0.7rem;
      color: white;
      width: 100%;
      border-radius: 0.5rem;
      background: url("../../../assets/images/bg-2.png") no-repeat;
      background-size: 100% 100%;
      position: relative;
      text-align: center;
    }

    .content-top-copy {
      font-size: 0.7rem;
      color: white;
      width: 100%;
      height: 9rem;
      border-radius: 0.5rem;
      background: url("../../../assets/images/bg-3.png") no-repeat;
      background-size: 100% 100%;
      position: relative;
      text-align: center;
    }

    .img {
      display: block;
      position: absolute;
      top: -15%;
      left: 40%;
      width: 3rem;
      height: 3rem;
      border-radius: 50%;
    }

    .flex-box {
      display: flex;
    }

    .content-top-top-box {
      padding: 2rem 0 1rem 0;
      font-size: 0.9rem;
      color: gold;
    }

    .content-top-top-box-copy {
      padding: 2rem 0 1rem 0;
      font-size: 0.9rem;
      color: black;
    }

    .content-top-center-box {
      justify-content: center;
      align-items: center;
      padding-top: 1rem;
    }

    .content-top-center-box-copy {
      justify-content: center;
      align-items: center;
      color: black;
      padding-top: 2rem;
    }

    .content-top-center-box-copy div {
      width: 20%;
      margin: 0 auto;
      border: 1px solid #666;
      border-radius: 0.4rem;
    }

    .content-top-center-box-copy div:active {
      color: #AB9277;
    }

    .text-box {
      padding: 0.2rem 0.5rem;
      border-radius: 0.4rem;
      background: #F46C5A;
    }

    .text-box:active {
      background: gainsboro;
    }

    /*会员服务列表*/
    .fz {
      font-size: 0.6rem;
    }

    .list {
      font-size: 0.7rem;
      color: #666;
      background: white;
      padding: 0.5rem;
    }

    .list-item {
      background: #f0f0f0;
      padding: 0.5rem 1rem;
      display: flex;
    }

    .item-left {
      padding-right: 5%;
      flex-shrink: 0;
      width: 65%;
    }

    .item-header {
      color: black;
      padding-bottom: 0.3rem;
    }

    .item-right {
      flex-shrink: 0;
      width: 30%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-around;
    }

    .label-box {
      text-align: center;
      font-size: 0.6rem;
      padding: 0.2rem 0.3rem;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
    }
  </style>
</head>
<body>
<div id='app'>
  <div id="loadStart"></div>
  <!--头部-->
  <div class="content" v-if="form.level === '1' || level === '1'">
    <div class="content-top">
      <img :src="formatImg(form.avatar)" alt="" class="img">
      <div class="content-top-top-box">
        <div class="">高级会员</div>
        <!--<div>NO.6898 0102 851</div>-->
      </div>
      <div class="flex-box content-top-center-box">
        <div>加入会员{{Continuedtime}}天</div>
        <div class="text-box aui-margin-l-5" @click="openChongzhi">续费</div>
      </div>
      <div class="aui-padded-b-10">
        剩余{{Surplustime}}天
      </div>
    </div>
  </div>
  <div class="content-copy" v-else-if="form.level != '1'">
    <div class="content-top-copy">
      <img :src="formatImg(form.avatar)" alt="" class="img">
      <div class="content-top-top-box-copy">
        <div class="">未成为会员</div>
        <!--<div>NO.6898 **** ***</div>-->
      </div>
      <div class="content-top-center-box-copy" @click="openChongzhi">
        <div>加入会员</div>
      </div>
    </div>
  </div>
  <!--会员服务-->
  <ul class="list">
    <div class="aui-padded-b-5">
      会员服务
      <svg class="icon icon1" aria-hidden="true">
        <use xlink:href="#icon-ziyuan2-copy-2"></use>
      </svg>
    </div>
    <li class="list-item aui-margin-t-10" v-for="item in list">
      <div class="item-left">
        <div class="item-header">{{item.title}}</div>
        <div class="fz">{{item.message}}</div>
      </div>
      <div class="item-right">
        <svg class="icon icon2" aria-hidden="true">
          <use :xlink:href="item.icon"></use>
        </svg>
        <div class="label-box">超级会员专享</div>
      </div>
    </li>
  </ul>
</div>
</body>
</html>
<script type="text/javascript" src="../../../assets/js/api.js"></script>
<script type="text/javascript" src="../../../assets/iconfont/iconfont.js"></script>
<script type="text/javascript" src="../../../assets/js/fastclick.js"></script>
<script>
  new FastClick(document.body);
</script>
<script type="text/javascript" src="../../../assets/js/vue.min.js"></script>
<script type="text/javascript" src="../../../assets/js/vue-resource.js"></script>
<script type="text/javascript" src="../../../assets/js/index.js"></script>
<script type="text/javascript" src="../../../assets/js/public.js"></script>
<script type="text/javascript">
  var app = new Vue({
    el: '#app',
    data: {
      list: [
        {
          icon: '#icon-youxianjiedai',
          title: '优先接待',
          message: '填写完善资料,获得特殊身份标识高级会员德推荐会根据您提交的资料而为您选择合适您的商家为您追踪服务'
        },
        {
          icon: '#icon-pinzhibaozheng',
          title: '品质保障',
          message: '填写完善资料,获得特殊身份标识高级会员德推荐会根据您提交的资料而为您选择合适您的商家为您追踪服务'
        },
        {
          icon: '#icon-dingzhifuwu',
          title: '定制服务',
          message: '填写完善资料,获得特殊身份标识高级会员德推荐会根据您提交的资料而为您选择合适您的商家为您追踪服务'
        },
        {
          icon: '#icon-huiyuanchangting',
          title: '会员畅听',
          message: '填写完善资料,获得特殊身份标识高级会员德推荐会根据您提交的资料而为您选择合适您的商家为您追踪服务'
        },
        {
          icon: '#icon-keziyouhui',
          title: '刻字优惠',
          message: '填写完善资料,获得特殊身份标识高级会员德推荐会根据您提交的资料而为您选择合适您的商家为您追踪服务'
        }
      ],
      form: {},
      level: '',
      formatImg: formatImg,
      Surplustime: '',
      date: '',  //当前时间
      Continuedtime: '', //会员持续时间
      firstCount: 0,  //loader监听
      username: ''
    },
    created: function () {
      apiready = function () {
        app.getTime();
        app.getUserInfo();
        app.checkHighMemberStatus();
        api.addEventListener({
          name: 'MemberUp'
        }, function (ret, err) {
          app.checkHighMemberStatus();
        });
      };
    },
    methods: {
      // 获取用户信息
      getUserInfo: function () {
        var post = {
          cmd: 'getUserInfo',
          token: getToken()
        };

        sendAjax(this, post, function (res) {
          if (res.data.username) {
            app.username = res.data.username.split("");
            app.username = '**' + app.username[app.username.length - 1];
          }
          app.form = res.data;
          api.sendEvent({
            name: 'vipfont',
            extra: {
              username: app.username
            }
          });

          loadEnd();
        });
      },
      // 获取当前时间
      getTime: function () {
        var dateTime = new Date();
        var YY = dateTime.getFullYear(),
          MM = dateTime.getMonth() + 1,
          dd = dateTime.getDate();
        if (MM >= 1 && MM <= 9) {
          MM = '0' + MM;
        }
        app.date = YY + '-' + MM + '-' + dd;
      },
//          检查高级会员状态
      checkHighMemberStatus: function () {
        var post = {
          cmd: 'checkHighMemberStatus',
          token: getToken()
        };
        sendAjax(this, post, function (res) {
          app.level = res.data.level;
          if (res && res.data.beginTime != null) {
            var supperExpire = (res.data.supperExpire).substring(0, (res.data.supperExpire).lastIndexOf(' ')),
              beginTime = (res.data.beginTime).substring(0, (res.data.beginTime).lastIndexOf(' '));
            var stime = app.daysBetween(supperExpire, beginTime);
            var Ctime = app.daysBetween(app.date, beginTime);
            app.Continuedtime = Ctime; //已加入会员时间
            app.Surplustime = stime;  // 剩余时间
          }
        });
      },
//          续费
      openChongzhi: function () {
        openView('chongzhi', 'leaguer/chongzhi/chongzhi_fm', '会员充值', false, false, {
          avatar: app.form.avatar,
          nickname: app.form.nickname
        })
      },
//      求时间差
      daysBetween: function (DateOne, DateTwo) {
        var OneMonth = DateOne.substring(5, DateOne.lastIndexOf('-'));
        var OneDay = DateOne.substring(DateOne.length, DateOne.lastIndexOf('-') + 1);
        var OneYear = DateOne.substring(0, DateOne.indexOf('-'));

        var TwoMonth = DateTwo.substring(5, DateTwo.lastIndexOf('-'));
        var TwoDay = DateTwo.substring(DateTwo.length, DateTwo.lastIndexOf('-') + 1);
        var TwoYear = DateTwo.substring(0, DateTwo.indexOf('-'));

        var cha = ((Date.parse(OneMonth + '/' + OneDay + '/' + OneYear) - Date.parse(TwoMonth + '/' + TwoDay + '/' + TwoYear)) / 86400000);
        return Math.abs(cha);
      }
    }
  })
</script>